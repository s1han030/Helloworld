let emojis = ['â˜€ï¸', 'ğŸ’§', 'ğŸŒ½', 'ğŸ›', 'ğŸŒ¾']; // å¯æ‰è½çš„ emoji
let egg, chick, chicken; // è§’è‰²å›¾åƒ
let fallingItems = []; // æ‰è½çš„ç‰©å“
let eggCount = 0;
let chickCount = { water: 0, corn: 0, bug: 0, grass: 0 };
let gameState = "egg"; // å½“å‰æ¸¸æˆé˜¶æ®µ

function setup() {
    createCanvas(800, 600);
    egg = createDiv('ğŸ¥š'); // åˆ›å»ºé¸¡è›‹
    egg.style('font-size', '50px');
    egg.position(mouseX, mouseY);

    // è®¾ç½®å®šæ—¶å™¨ç”Ÿæˆæ‰è½ç‰©å“
    setInterval(() => {
        for (let i = 0; i < 3; i++) { // æ¯ç§’ç”Ÿæˆ3ä¸ªemoji
            fallingItems.push({ emoji: random(emojis), x: random(width), y: 0 });
        }
    }, 1000);
}

function draw() {
    background(255, 225, 156); // è®¾ç½®èƒŒæ™¯é¢œè‰²

    // æ›´æ–°é¸¡è›‹/å°é¸¡/é¸¡çš„ä½ç½®
    if (gameState === "egg") {
        egg.position(mouseX, mouseY);
    } else if (gameState === "chick") {
        chick.position(mouseX, mouseY);
    } else if (gameState === "chicken") {
        chicken.position(mouseX, mouseY);
    }

    // ç»˜åˆ¶æ‰è½ç‰©å“
    for (let i = fallingItems.length - 1; i >= 0; i--) {
        let item = fallingItems[i];
        textSize(30);
        text(item.emoji, item.x, item.y);
        item.y += 5; // ç‰©å“æ‰è½

        // æ£€æµ‹ç¢°æ’
        if (dist(item.x, item.y, mouseX, mouseY) < 25) {
            handleCatch(item.emoji); // å¤„ç†æ•è·åˆ°çš„ç‰©å“
            fallingItems.splice(i, 1); // ç§»é™¤å·²æ•è·çš„ç‰©å“
        }

        // è¶…å‡ºç”»é¢ï¼Œç§»é™¤ç‰©å“
        if (item.y > height) {
            fallingItems.splice(i, 1);
        }
    }
}

function handleCatch(caught) {
    if (gameState === "egg" && caught === 'â˜€ï¸') {
        eggCount++;
        if (eggCount >= 3) { // æ•è·3ä¸ªâ˜€ï¸
            egg.remove();
            startChick(); // å˜ä¸ºå°é¸¡
        }
    } else if (gameState === "chick") {
        if (caught === 'ğŸ’§') {
            chickCount.water++;
        } else if (caught === 'ğŸŒ½') {
            chickCount.corn++;
        } else if (caught === 'ğŸ›') {
            chickCount.bug++;
        } else if (caught === 'ğŸŒ¾') {
            chickCount.grass++;
        }

        // æ£€æŸ¥å°é¸¡çš„çŠ¶æ€
        if (chickCount.water >= 5
            && (chickCount.corn > 0 && chickCount.bug > 0 && chickCount.grass > 0)) {
            chick.remove();
            startChicken(); // å˜ä¸ºé¸¡
        }
    }
}

function startChick() {
    gameState = "chick"; // è¿›å…¥ç¬¬äºŒé˜¶æ®µ
    chick = createDiv('ğŸ¤'); // åˆ›å»ºå°é¸¡
    chick.style('font-size', '50px');
    chick.position(mouseX, mouseY);
}

function startChicken() {
    gameState = "chicken"; // è¿›å…¥ç¬¬ä¸‰é˜¶æ®µ
    chicken = createDiv('ğŸ”'); // åˆ›å»ºé¸¡
    chicken.style('font-size', '50px');
    chicken.position(mouseX, mouseY);
}

// æ›´æ–°å°é¸¡/é¸¡çš„ä½ç½®
function mouseMoved() {
    if (gameState === "chick") {
        chick.position(mouseX, mouseY);
    } else if (gameState === "chicken") {
        chicken.position(mouseX, mouseY);
    }
}
